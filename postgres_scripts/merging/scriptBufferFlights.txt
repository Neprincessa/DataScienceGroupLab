create table public."TMPBufferFlights"
(
	id SERIAL,
	ticket_number VARCHAR(30) NULL,
	flight_number VARCHAR(30) NULL, 
	dep_city VARCHAR(30) NULL,
	dep_country VARCHAR(30) NULL,
	dest_city VARCHAR(30) NULL,
	dest_country VARCHAR(30) NULL,
	dep_date DATE NULL,
	travel_class VARCHAR(30) NULL	
);

create table public."BufferFlights"
(
	id SERIAL,
	ticket_number VARCHAR(30) NULL,
	flight_number VARCHAR(30) NULL, 
	dep_city VARCHAR(30) NULL,
	dep_country VARCHAR(30) NULL,
	dest_city VARCHAR(30) NULL,
	dest_country VARCHAR(30) NULL,
	dep_date DATE NULL,
	travel_class VARCHAR(30) NULL,
	baggage VARCHAR(30) NULL	
);


TRUNCATE public."TMPBufferFlights";
TRUNCATE public."BufferFlights";


INSERT INTO 
 public."TMPBufferFlights" (ticket_number, flight_number, dep_city,
			dest_city, dep_date, travel_class)
SELECT DISTINCT 
 YBPDA.ticket_number, 
 YBPDA.flight_number,
 YBPDA.dep_city,
 YBPDA.dest_city,
 YBPDA.dep_date,
 YBPDA.Y_info
FROM 
 public."YourBoardingPassDotAero" as YBPDA;


INSERT INTO 
 public."TMPBufferFlights" (ticket_number, dep_city,
			dest_city, dep_date, travel_class)
SELECT DISTINCT 
 S.Code_e_Ticket, 
 S.From_,
 S.Dest,
 S.DepartDate,
 S.TrvCls_Fare
FROM 
 public."Sirena" as S
WHERE
 S.Code_e_Ticket NOT IN (SELECT ticket_number FROM public."TMPBufferFlights");
 
INSERT INTO 
 public."TMPBufferFlights" (ticket_number, flight_number,
			dest_city, dep_date)
SELECT DISTINCT 
 ticket_number,
 flight_number,
 dest_city,
 dep_date
FROM 
 public."BoardingData" as BD
WHERE
 BD.ticket_number NOT IN (SELECT ticket_number FROM public."TMPBufferFlights");

INSERT INTO 
 public."BufferFlights" (ticket_number, flight_number, dep_city, dep_country,
			dest_city, dest_country, dep_date, travel_class, baggage)
SELECT DISTINCT 
 tmpBF.ticket_number, 
 tmpBF.flight_number, 
 tmpBF.dep_city, 
 tmpBF.dep_country,
 tmpBF.dest_city, 
 tmpBF.dest_country,
 tmpBF.dep_date, 
 tmpBF.travel_class,
 BD.baggage
FROM 
 (SELECT DISTINCT
  ticket_number,
  baggage
 FROM public."BoardingData") as BD
 RIGHT JOIN
  public."TMPBufferFlights" as tmpBF
 ON
  tmpBF.ticket_number=BD.ticket_number;
